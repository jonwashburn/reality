import Mathlib

namespace IndisputableMonolith
namespace Ethics

universe u

/-- A minimal cost model over actions of type `A`. Costs are nonnegative reals. -/
structure CostModel (A : Type u) where
  cost : A → ℝ
  nonneg : ∀ a, 0 ≤ cost a

variable {A : Type u}

/-- Ethical preference: `a ≼ b` iff `cost a ≤ cost b` (lower cost is better). -/
def Prefer (M : CostModel A) (a b : A) : Prop := M.cost a ≤ M.cost b

infix:50 "≼" => Prefer

/-- Net improvement predicate: `a` strictly improves on `b`. -/
def Improves (M : CostModel A) (a b : A) : Prop := M.cost a < M.cost b

/-- Reflexivity: every action is at least as good as itself. -/
lemma prefer_refl (M : CostModel A) (a : A) : a ≼[M] a := by
  dsimp [Prefer]
  exact le_rfl

/-- Transitivity: if `a ≼ b` and `b ≼ c`, then `a ≼ c`. -/
lemma prefer_trans (M : CostModel A) {a b c : A}
  (hab : a ≼[M] b) (hbc : b ≼[M] c) : a ≼[M] c := by
  dsimp [Prefer] at hab hbc ⊢; exact le_trans hab hbc

/-- Preorder instance for preference. -/
instance (M : CostModel A) : Preorder A where
  le := Prefer M
  le_refl := prefer_refl (M:=M)
  le_trans := prefer_trans (M:=M)

/-- Composable actions under a cost model: binary composition with subadditivity and monotonicity. -/
structure Composable (M : CostModel A) where
  comp : A → A → A
  subadd : ∀ a b, M.cost (comp a b) ≤ M.cost a + M.cost b
  mono : ∀ a a' b b', a ≼[M] a' → b ≼[M] b' → comp a b ≼[M] comp a' b'
  strict_mono_left : ∀ a a' x, Improves M a a' → Improves M (comp a x) (comp a' x)

/-- Monotonicity of composition w.r.t. preference. -/
theorem prefer_comp_mono (M : CostModel A) (C : Composable M)
  {a₁ a₂ b₁ b₂ : A}
  (ha : a₁ ≼[M] a₂) (hb : b₁ ≼[M] b₂) :
  C.comp a₁ b₁ ≼[M] C.comp a₂ b₂ := by
  dsimp [Prefer] at ha hb ⊢
  exact C.mono a₁ a₂ b₁ b₂ ha hb

/-- Composition preserves improvement. -/
theorem improves_comp_left (M : CostModel A) (C : Composable M)
  {a b x : A} (h : Improves M a b) : Improves M (C.comp a x) (C.comp b x) := by
  exact C.strict_mono_left a b x h

end Ethics
end IndisputableMonolith

